@namespace CopilotConnectorGui.Shared
@using CopilotConnectorGui.Components
@using CopilotConnectorGui.Services
@inject TenantCredentialService CredentialService
@inherits LayoutComponentBase

<div class="page">
    <div class="bg-light border-bottom py-2 px-3 mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-0">
                    <i class="bi bi-microsoft"></i> Microsoft Graph Copilot Connector
                </h5>
            </div>
            <div class="d-flex gap-2 align-items-center">
                @if (CredentialService.HasOverride())
                {
                    <span class="badge bg-success">
                        <i class="bi bi-shield-check"></i> Custom Tenant Active
                    </span>
                }
                <button class="btn btn-outline-primary btn-sm" @onclick="ShowLoginModal">
                    <i class="bi bi-key"></i> @(CredentialService.HasOverride() ? "Change" : "Login to") Tenant
                </button>
            </div>
        </div>
    </div>

    <main>
        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

<TenantLoginModal ShowModal="_showLoginModal" 
                  ShowModalChanged="OnModalChanged" 
                  OnCredentialsChanged="OnCredentialsChanged" />

@code {
    private bool _showLoginModal = false;

    private void ShowLoginModal()
    {
        _showLoginModal = true;
    }

    private Task OnModalChanged(bool show)
    {
        _showLoginModal = show;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task OnCredentialsChanged()
    {
        StateHasChanged();
        return Task.CompletedTask;
    }
}
